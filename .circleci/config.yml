# This config was automatically generated from your source code
# Stacks detected: deps:go:.
version: 2.1
orbs:
  aws-cli: circleci/aws-cli@3.1
jobs:
  test-go:
    # Install go modules and run tests
    docker:
      - image: cimg/go:1.20
    steps:
      - checkout
      - run:
          name: Run tests
          command: gotestsum --junitfile junit.xml
      - store_test_results:
          path: junit.xml
  deploy:
    # This is an example deploy job, not actually used by the workflow
    docker:
      - image: cimg/base:stable
    steps:
      # Replace this with steps to deploy to users
      - aws-cli/setup:
          role-arn: 'arn:aws:iam::${AWS_ACCOUNT}:role/CircleCIActionsRole'
          aws-region: AWS_REGION
          profile-name: "OIDC-PROFILE"
          role-session-name: "circle-ci-integration"
          session-duration: "900"
      - run:
          name: whoami
          command: |
             aws sts get-caller-identity
workflows:
  build-and-test:
    jobs:
      - test-go
      - deploy
    #     requires:
    #       - test-go
